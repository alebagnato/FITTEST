--
-- Specifies for each instruction what the effect on the stack is as a delta integer.
-- The affect at the end of the instruction.
--

ATTR InstructionLike [ | | afterEffect : Int ]

SEM Instruction
  | Add                lhs.afterEffect = popEffect 1
  | Add_i              lhs.afterEffect = popEffect 1
  | Add_d              lhs.afterEffect = popEffect 1
  | ApplyType          lhs.afterEffect = popEffect 1
  | AsType             lhs.afterEffect = noEffect
  | AsTypeLate         lhs.afterEffect = popEffect 1
  | BitAnd             lhs.afterEffect = popEffect 1
  | BitNot             lhs.afterEffect = noEffect
  | BitOr              lhs.afterEffect = popEffect 1
  | BitXor             lhs.afterEffect = popEffect 1
  | Breakpoint         lhs.afterEffect = noEffect
  | BreakLine          lhs.afterEffect = noEffect
  | Call               lhs.afterEffect = popEffect (1 + @argCount)
  | CallInterface      lhs.afterEffect = popEffect (@argCount + @loc.nmExtra)
  | CallMethod         lhs.afterEffect = popEffect @argCount
  | CallProp           lhs.afterEffect = popEffect (@argCount + @loc.nmExtra)
  | CallPropLex        lhs.afterEffect = popEffect (@argCount + @loc.nmExtra)
  | CallPropVoid       lhs.afterEffect = popEffect (1 + @argCount + @loc.nmExtra)
  | CallStatic         lhs.afterEffect = popEffect @argCount
  | CallSuper          lhs.afterEffect = popEffect (@argCount + @loc.nmExtra)
  | CallSuperId        lhs.afterEffect = noEffect  -- todo: unknown stack behavior
  | CallSuperVoid      lhs.afterEffect = popEffect (1 + @argCount + @loc.nmExtra)
  | CheckFilter        lhs.afterEffect = noEffect
  | Coerce             lhs.afterEffect = noEffect
  | Coerce_b           lhs.afterEffect = noEffect
  | Coerce_a           lhs.afterEffect = noEffect
  | Coerce_i           lhs.afterEffect = noEffect
  | Coerce_d           lhs.afterEffect = noEffect
  | Coerce_s           lhs.afterEffect = noEffect
  | Coerce_u           lhs.afterEffect = noEffect
  | Coerce_o           lhs.afterEffect = noEffect
  | Concat             lhs.afterEffect = popEffect 1
  | Construct          lhs.afterEffect = popEffect @argCount
  | ConstructProp      lhs.afterEffect = popEffect (@argCount + @loc.nmExtra)
  | ConstructSuper     lhs.afterEffect = popEffect (1 + @argCount)
  | Convert_b          lhs.afterEffect = noEffect
  | Convert_i          lhs.afterEffect = noEffect
  | Convert_d          lhs.afterEffect = noEffect
  | Convert_o          lhs.afterEffect = noEffect
  | Convert_u          lhs.afterEffect = noEffect
  | Convert_s          lhs.afterEffect = noEffect
  | Debug              lhs.afterEffect = noEffect
  | DebugFile          lhs.afterEffect = noEffect
  | DebugLine          lhs.afterEffect = noEffect
  | DecLocal           lhs.afterEffect = noEffect
  | DecLocal_i         lhs.afterEffect = noEffect
  | Decrement          lhs.afterEffect = noEffect
  | Decrement_i        lhs.afterEffect = noEffect
  | DeleteProperty     lhs.afterEffect = popEffect @loc.nmExtra
  | DeletePropertyLate lhs.afterEffect = popEffect 1  -- todo: unknown
  | Divide             lhs.afterEffect = popEffect 1
  | Dup                lhs.afterEffect = pushEffect 1
  | Dxns               lhs.afterEffect = noEffect
  | DxnsLate           lhs.afterEffect = popEffect 1
  | Equals             lhs.afterEffect = popEffect 1
  | EscXAttr           lhs.afterEffect = noEffect
  | EscXElem           lhs.afterEffect = noEffect
  | FindDef            lhs.afterEffect = pushEffect (1 - @loc.nmExtra)
  | FindPropertyGlobalStrict  lhs.afterEffect = pushEffect (1 - @loc.nmExtra)
  | FindPropertyGlobal        lhs.afterEffect = pushEffect (1 - @loc.nmExtra)
  | FindProperty              lhs.afterEffect = pushEffect (1 - @loc.nmExtra)
  | FindPropStrict            lhs.afterEffect = pushEffect (1 - @loc.nmExtra)
  | GetDescendants            lhs.afterEffect = popEffect @loc.nmExtra
  | GetGlobalScope     lhs.afterEffect = pushEffect 1
  | GetGlobalSlot      lhs.afterEffect = pushEffect 1
  | GetLex             lhs.afterEffect = pushEffect 1
  | GetLocal           lhs.afterEffect = pushEffect 1
  | GetLocal0          lhs.afterEffect = pushEffect 1
  | GetLocal1          lhs.afterEffect = pushEffect 1
  | GetLocal2          lhs.afterEffect = pushEffect 1
  | GetLocal3          lhs.afterEffect = pushEffect 1
  | GetOuterScope      lhs.afterEffect = pushEffect 1
  | GetProperty        lhs.afterEffect = popEffect @loc.nmExtra
  | GetScopeObject     lhs.afterEffect = pushEffect 1
  | GetSlot            lhs.afterEffect = noEffect
  | GetSuper           lhs.afterEffect = popEffect @loc.nmExtra
  | GreaterEquals      lhs.afterEffect = popEffect 1
  | GreaterThan        lhs.afterEffect = popEffect 1
  | HasNext            lhs.afterEffect = popEffect 1
  | HasNext2           lhs.afterEffect = pushEffect 1
  | IfEq               lhs.afterEffect = popEffect 2
  | IfFalse            lhs.afterEffect = popEffect 1
  | IfGe               lhs.afterEffect = popEffect 2
  | IfGt               lhs.afterEffect = popEffect 2
  | IfLe               lhs.afterEffect = popEffect 2
  | IfLt               lhs.afterEffect = popEffect 2
  | IfNGe              lhs.afterEffect = popEffect 2
  | IfNGt              lhs.afterEffect = popEffect 2
  | IfNLe              lhs.afterEffect = popEffect 2
  | IfNLt              lhs.afterEffect = popEffect 2
  | IfNe               lhs.afterEffect = popEffect 2
  | IfStrictEq         lhs.afterEffect = popEffect 2
  | IfStrictNe         lhs.afterEffect = popEffect 2
  | IfTrue             lhs.afterEffect = popEffect 1
  | In                 lhs.afterEffect = popEffect 1
  | IncLocal           lhs.afterEffect = noEffect
  | IncLocal_i         lhs.afterEffect = noEffect
  | Increment          lhs.afterEffect = noEffect
  | Increment_i        lhs.afterEffect = noEffect
  | InitProperty       lhs.afterEffect = popEffect (2 + @loc.nmExtra)
  | InstanceOf         lhs.afterEffect = popEffect 1
  | IsType             lhs.afterEffect = noEffect
  | IsTypeLate         lhs.afterEffect = popEffect 1
  | Jump               lhs.afterEffect = noEffect
  | Kill               lhs.afterEffect = noEffect
  | Label              lhs.afterEffect = noEffect
  | LessEquals         lhs.afterEffect = popEffect 1
  | LessThan           lhs.afterEffect = popEffect 1
  | LoadFloat32        lhs.afterEffect = noEffect
  | LoadFloat64        lhs.afterEffect = noEffect
  | LoadIndirect8      lhs.afterEffect = noEffect
  | LoadIndirect16     lhs.afterEffect = noEffect
  | LoadIndirect32     lhs.afterEffect = noEffect
  | LookupSwitch       lhs.afterEffect = popEffect 1
  | Lshift             lhs.afterEffect = popEffect 1
  | Modulo             lhs.afterEffect = popEffect 1
  | Multiply           lhs.afterEffect = popEffect 1
  | Multiply_i         lhs.afterEffect = popEffect 1
  | Negate             lhs.afterEffect = noEffect
  | Negate_i           lhs.afterEffect = noEffect
  | NewActivation      lhs.afterEffect = pushEffect 1
  | NewArray           lhs.afterEffect = pushEffect (1 - @argCount)
  | NewCatch           lhs.afterEffect = pushEffect 1
  | NewClass           lhs.afterEffect = noEffect
  | NewFunction        lhs.afterEffect = pushEffect 1
  | NewObject          lhs.afterEffect = pushEffect (1 - @argCount)
  | NextName           lhs.afterEffect = popEffect 1
  | NextValue          lhs.afterEffect = popEffect 1
  | Nop                lhs.afterEffect = noEffect
  | Not                lhs.afterEffect = noEffect
  | Pop                lhs.afterEffect = popEffect 1
  | PopScope           lhs.afterEffect = noEffect
  | PushByte           lhs.afterEffect = pushEffect 1
  | PushDouble         lhs.afterEffect = pushEffect 1
  | PushFalse          lhs.afterEffect = pushEffect 1
  | PushInt            lhs.afterEffect = pushEffect 1
  | PushNamespace      lhs.afterEffect = pushEffect 1
  | PushNaN            lhs.afterEffect = pushEffect 1
  | PushNull           lhs.afterEffect = pushEffect 1
  | PushScope          lhs.afterEffect = popEffect 1
  | PushShort          lhs.afterEffect = pushEffect 1
  | PushString         lhs.afterEffect = pushEffect 1
  | PushTrue           lhs.afterEffect = pushEffect 1
  | PushUInt           lhs.afterEffect = pushEffect 1
  | PushUndefined      lhs.afterEffect = pushEffect 1
  | PushWith           lhs.afterEffect = popEffect 1
  | ReturnValue        lhs.afterEffect = popEffect 1
  | ReturnVoid         lhs.afterEffect = noEffect
  | Rshift             lhs.afterEffect = popEffect 1
  | SetLocal           lhs.afterEffect = popEffect 1
  | SetLocal0          lhs.afterEffect = popEffect 1
  | SetLocal1          lhs.afterEffect = popEffect 1
  | SetLocal2          lhs.afterEffect = popEffect 1
  | SetLocal3          lhs.afterEffect = popEffect 1
  | SetGlobalSlot      lhs.afterEffect = popEffect 1
  | SetProperty        lhs.afterEffect = popEffect (2 + @loc.nmExtra)
  | SetPropertyLate    lhs.afterEffect = popEffect 3
  | SetSlot            lhs.afterEffect = popEffect 2
  | SetSuper           lhs.afterEffect = popEffect (2 + @loc.nmExtra)
  | SignExtend1        lhs.afterEffect = noEffect
  | SignExtend8        lhs.afterEffect = noEffect
  | SignExtend16       lhs.afterEffect = noEffect
  | StoreFloat32       lhs.afterEffect = popEffect 2
  | StoreFloat64       lhs.afterEffect = popEffect 2
  | StoreIndirect8     lhs.afterEffect = popEffect 2
  | StoreIndirect16    lhs.afterEffect = popEffect 2
  | StoreIndirect32    lhs.afterEffect = popEffect 2
  | StrictEquals       lhs.afterEffect = popEffect 1
  | Substract          lhs.afterEffect = popEffect 1
  | Substract_i        lhs.afterEffect = popEffect 1
  | Swap               lhs.afterEffect = noEffect
  | Throw              lhs.afterEffect = popEffect 1
  | Timestamp          lhs.afterEffect = pushEffect 1  -- todo: unknown
  | TypeOf             lhs.afterEffect = noEffect
  | Urshift            lhs.afterEffect = popEffect 1
  | Virtual            lhs.afterEffect = noEffect
